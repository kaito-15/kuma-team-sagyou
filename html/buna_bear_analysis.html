<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ–ãƒŠè±Šå‡¶ã¨ã‚¯ãƒå‡ºæ²¡ã®åˆ†æ</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React Is (Required by Recharts) -->
    <script crossorigin src="https://unpkg.com/react-is@18/umd/react-is.production.min.js"></script>

    <!-- Prop Types -->
    <script crossorigin src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- Recharts (Using a specific version known to work well with UMD) -->
    <script crossorigin src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #0f172a;
            /* Dark Slate */
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #38bdf8;
            /* Sky Blue */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #334155;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f8fafc;
        }

        select {
            background-color: #334155;
            color: #fff;
            border: 1px solid #475569;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 1rem;
            outline: none;
        }

        .chart-container {
            width: 100%;
            height: 400px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .stat-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #334155;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fbbf24;
            /* Amber */
        }

        .stat-label {
            font-size: 0.875rem;
            color: #94a3b8;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const {
            LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
            ComposedChart, ScatterChart, Scatter, ZAxis, Cell
        } = Recharts;

        // --- DATA ---
        // Embedded CSV Data
        const rawBunaCsv = `prefecture,year,flowering,fruiting
é’æ£®çœŒ,1989,,3.4
é’æ£®çœŒ,1990,3.4,2.2
é’æ£®çœŒ,1991,0.8,0.6
é’æ£®çœŒ,1992,4.5,4.1
é’æ£®çœŒ,1993,2.1,1.0
é’æ£®çœŒ,1994,1.7,1.3
é’æ£®çœŒ,1995,4.0,4.2
é’æ£®çœŒ,1996,0.7,0.6
é’æ£®çœŒ,1997,2.2,1.8
é’æ£®çœŒ,1998,1.7,1.4
é’æ£®çœŒ,1999,1.1,0.7
é’æ£®çœŒ,2000,4.6,4.7
é’æ£®çœŒ,2001,0.3,0.2
é’æ£®çœŒ,2002,1.2,1.0
é’æ£®çœŒ,2003,2.5,2.4
é’æ£®çœŒ,2004,1.1,0.8
é’æ£®çœŒ,2005,3.8,3.4
é’æ£®çœŒ,2006,0.5,0.2
é’æ£®çœŒ,2007,1.7,0.8
é’æ£®çœŒ,2008,2.4,1.6
é’æ£®çœŒ,2009,2.0,1.4
é’æ£®çœŒ,2010,1.6,0.7
é’æ£®çœŒ,2011,2.6,1.3
é’æ£®çœŒ,2012,1.3,0.4
é’æ£®çœŒ,2013,3.6,3.4
é’æ£®çœŒ,2014,1.7,0.7
é’æ£®çœŒ,2015,2.8,2.0
é’æ£®çœŒ,2016,1.4,0.5
é’æ£®çœŒ,2017,2.0,1.2
é’æ£®çœŒ,2018,2.0,1.2
é’æ£®çœŒ,2019,1.6,0.6
é’æ£®çœŒ,2020,3.2,2.3
é’æ£®çœŒ,2021,2.0,1.0
é’æ£®çœŒ,2022,3.8,2.9
é’æ£®çœŒ,2023,0.5,0.1
é’æ£®çœŒ,2024,3.7,3.8
å²©æ‰‹çœŒ,1989,,
å²©æ‰‹çœŒ,1990,4.3,3.3
å²©æ‰‹çœŒ,1991,0.7,0.4
å²©æ‰‹çœŒ,1992,2.3,2.2
å²©æ‰‹çœŒ,1993,3.3,1.9
å²©æ‰‹çœŒ,1994,0.9,0.6
å²©æ‰‹çœŒ,1995,3.6,3.6
å²©æ‰‹çœŒ,1996,0.9,1.2
å²©æ‰‹çœŒ,1997,2.2,1.5
å²©æ‰‹çœŒ,1998,1.4,1.0
å²©æ‰‹çœŒ,1999,1.1,0.8
å²©æ‰‹çœŒ,2000,4.6,4.4
å²©æ‰‹çœŒ,2001,0.9,0.6
å²©æ‰‹çœŒ,2002,1.3,1.2
å²©æ‰‹çœŒ,2003,2.5,1.8
å²©æ‰‹çœŒ,2004,1.0,0.4
å²©æ‰‹çœŒ,2005,4.0,4.3
å²©æ‰‹çœŒ,2006,0.4,0.2
å²©æ‰‹çœŒ,2007,1.5,1.5
å²©æ‰‹çœŒ,2008,2.1,1.5
å²©æ‰‹çœŒ,2009,1.8,1.1
å²©æ‰‹çœŒ,2010,1.1,0.7
å²©æ‰‹çœŒ,2011,3.2,1.3
å²©æ‰‹çœŒ,2012,0.7,0.0
å²©æ‰‹çœŒ,2013,4.0,3.8
å²©æ‰‹çœŒ,2014,0.3,0.2
å²©æ‰‹çœŒ,2015,4.0,4.2
å²©æ‰‹çœŒ,2016,0.3,0.0
å²©æ‰‹çœŒ,2017,1.4,1.2
å²©æ‰‹çœŒ,2018,2.8,1.8
å²©æ‰‹çœŒ,2019,0.8,0.1
å²©æ‰‹çœŒ,2020,1.8,1.3
å²©æ‰‹çœŒ,2021,1.0,0.7
å²©æ‰‹çœŒ,2022,3.3,2.7
å²©æ‰‹çœŒ,2023,0.4,0.0
å²©æ‰‹çœŒ,2024,3.2,2.7
å®®åŸçœŒ,1989,,1.9
å®®åŸçœŒ,1990,2.5,3.3
å®®åŸçœŒ,1991,1.2,0.5
å®®åŸçœŒ,1992,1.5,1.3
å®®åŸçœŒ,1993,2.3,1.7
å®®åŸçœŒ,1994,0.4,0.9
å®®åŸçœŒ,1995,4.3,4.0
å®®åŸçœŒ,1996,0.2,0.0
å®®åŸçœŒ,1997,0.5,0.7
å®®åŸçœŒ,1998,0.5,0.2
å®®åŸçœŒ,1999,0.2,0.0
å®®åŸçœŒ,2000,2.7,3.7
å®®åŸçœŒ,2001,0.8,0.7
å®®åŸçœŒ,2002,1.5,1.5
å®®åŸçœŒ,2003,0.7,0.2
å®®åŸçœŒ,2004,1.7,2.0
å®®åŸçœŒ,2005,4.7,4.3
å®®åŸçœŒ,2006,1.0,0.2
å®®åŸçœŒ,2007,1.5,1.3
å®®åŸçœŒ,2008,3.7,1.7
å®®åŸçœŒ,2009,3.3,2.0
å®®åŸçœŒ,2010,3.2,0.5
å®®åŸçœŒ,2011,3.7,1.5
å®®åŸçœŒ,2012,2.8,2.2
å®®åŸçœŒ,2013,3.7,5.0
å®®åŸçœŒ,2014,1.3,0.7
å®®åŸçœŒ,2015,3.3,3.4
å®®åŸçœŒ,2016,0.5,0.0
å®®åŸçœŒ,2017,0.7,0.7
å®®åŸçœŒ,2018,3.0,2.5
å®®åŸçœŒ,2019,0.3,0.3
å®®åŸçœŒ,2020,1.7,0.7
å®®åŸçœŒ,2021,4.0,1.7
å®®åŸçœŒ,2022,4.0,1.3
å®®åŸçœŒ,2023,0.8,0.0
å®®åŸçœŒ,2024,3.7,4.2
ç§‹ç”°çœŒ,2004,1.1,0.5
ç§‹ç”°çœŒ,2005,4.3,3.9
ç§‹ç”°çœŒ,2006,0.5,0.2
ç§‹ç”°çœŒ,2007,1.8,1.6
ç§‹ç”°çœŒ,2008,1.3,1.0
ç§‹ç”°çœŒ,2009,1.9,1.2
ç§‹ç”°çœŒ,2010,0.8,0.3
ç§‹ç”°çœŒ,2011,1.8,1.1
ç§‹ç”°çœŒ,2012,0.9,0.7
ç§‹ç”°çœŒ,2013,3.6,2.9
ç§‹ç”°çœŒ,2014,0.8,0.4
ç§‹ç”°çœŒ,2015,2.4,1.8
ç§‹ç”°çœŒ,2016,0.5,0.1
ç§‹ç”°çœŒ,2017,1.0,0.7
ç§‹ç”°çœŒ,2018,2.2,1.7
ç§‹ç”°çœŒ,2019,0.6,0.2
ç§‹ç”°çœŒ,2020,2.8,2.0
ç§‹ç”°çœŒ,2021,1.0,0.2
ç§‹ç”°çœŒ,2022,3.7,2.8
ç§‹ç”°çœŒ,2023,0.3,0.1
ç§‹ç”°çœŒ,2024,2.6,2.6
å±±å½¢çœŒ,1989,,0.5
å±±å½¢çœŒ,2004,1.0,0.4
å±±å½¢çœŒ,2005,4.9,4.9
å±±å½¢çœŒ,2006,0.9,0.0
å±±å½¢çœŒ,2007,3.0,1.3
å±±å½¢çœŒ,2008,2.5,1.5
å±±å½¢çœŒ,2009,3.1,1.3
å±±å½¢çœŒ,2010,1.1,0.2
å±±å½¢çœŒ,2011,3.3,2.0
å±±å½¢çœŒ,2012,0.8,0.2
å±±å½¢çœŒ,2013,2.3,2.3
å±±å½¢çœŒ,2014,0.6,0.2
å±±å½¢çœŒ,2015,3.4,3.5
å±±å½¢çœŒ,2016,0.7,0.1
å±±å½¢çœŒ,2017,0.9,0.4
å±±å½¢çœŒ,2018,4.0,3.9
å±±å½¢çœŒ,2019,0.1,0.0
å±±å½¢çœŒ,2020,0.7,0.3
å±±å½¢çœŒ,2021,1.9,1.5
å±±å½¢çœŒ,2022,3.4,3.1
å±±å½¢çœŒ,2023,0.7,0.1
å±±å½¢çœŒ,2024,3.3,2.9`;

        const rawBearCsv = `prefecture,year,count
åŒ—æµ·é“,2008,3
åŒ—æµ·é“,2009,2
åŒ—æµ·é“,2010,3
åŒ—æµ·é“,2011,2
åŒ—æµ·é“,2012,2
åŒ—æµ·é“,2013,4
åŒ—æµ·é“,2014,5
åŒ—æµ·é“,2015,0
åŒ—æµ·é“,2016,1
åŒ—æµ·é“,2017,4
åŒ—æµ·é“,2018,3
åŒ—æµ·é“,2019,3
åŒ—æµ·é“,2020,2
åŒ—æµ·é“,2021,9
åŒ—æµ·é“,2022,3
åŒ—æµ·é“,2023,6
åŒ—æµ·é“,2024,3
é’æ£®,2008,2
é’æ£®,2009,4
é’æ£®,2010,4
é’æ£®,2011,5
é’æ£®,2012,2
é’æ£®,2013,2
é’æ£®,2014,3
é’æ£®,2015,2
é’æ£®,2016,0
é’æ£®,2017,8
é’æ£®,2018,3
é’æ£®,2019,5
é’æ£®,2020,5
é’æ£®,2021,1
é’æ£®,2022,1
é’æ£®,2023,10
é’æ£®,2024,4
å²©æ‰‹,2008,9
å²©æ‰‹,2009,14
å²©æ‰‹,2010,14
å²©æ‰‹,2011,16
å²©æ‰‹,2012,19
å²©æ‰‹,2013,7
å²©æ‰‹,2014,13
å²©æ‰‹,2015,13
å²©æ‰‹,2016,17
å²©æ‰‹,2017,16
å²©æ‰‹,2018,12
å²©æ‰‹,2019,15
å²©æ‰‹,2020,27
å²©æ‰‹,2021,14
å²©æ‰‹,2022,23
å²©æ‰‹,2023,46
å²©æ‰‹,2024,10
å®®åŸ,2008,1
å®®åŸ,2009,1
å®®åŸ,2010,3
å®®åŸ,2011,3
å®®åŸ,2012,0
å®®åŸ,2013,3
å®®åŸ,2014,4
å®®åŸ,2015,1
å®®åŸ,2016,6
å®®åŸ,2017,3
å®®åŸ,2018,1
å®®åŸ,2019,6
å®®åŸ,2020,1
å®®åŸ,2021,2
å®®åŸ,2022,5
å®®åŸ,2023,3
å®®åŸ,2024,0
ç§‹ç”°,2008,4
ç§‹ç”°,2009,8
ç§‹ç”°,2010,10
ç§‹ç”°,2011,17
ç§‹ç”°,2012,6
ç§‹ç”°,2013,5
ç§‹ç”°,2014,10
ç§‹ç”°,2015,7
ç§‹ç”°,2016,19
ç§‹ç”°,2017,19
ç§‹ç”°,2018,7
ç§‹ç”°,2019,14
ç§‹ç”°,2020,8
ç§‹ç”°,2021,12
ç§‹ç”°,2022,6
ç§‹ç”°,2023,62
ç§‹ç”°,2024,10
å±±å½¢,2008,1
å±±å½¢,2009,2
å±±å½¢,2010,10
å±±å½¢,2011,4
å±±å½¢,2012,5
å±±å½¢,2013,0
å±±å½¢,2014,2
å±±å½¢,2015,1
å±±å½¢,2016,2
å±±å½¢,2017,4
å±±å½¢,2018,1
å±±å½¢,2019,4
å±±å½¢,2020,5
å±±å½¢,2021,0
å±±å½¢,2022,2
å±±å½¢,2023,5
å±±å½¢,2024,4`;

        // --- PARSING LOGIC ---
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const row = lines[i].split(',');
                const obj = {};
                headers.forEach((h, index) => {
                    let val = row[index];
                    if (val === undefined || val === '') {
                        val = null;
                    } else if (!isNaN(val)) {
                        val = parseFloat(val);
                    }
                    obj[h] = val;
                });
                result.push(obj);
            }
            return result;
        }

        const bunaData = parseCSV(rawBunaCsv);
        const bearData = parseCSV(rawBearCsv);

        // Normalize Prefecture Names (Remove 'çœŒ' from bunaData)
        bunaData.forEach(d => {
            if (d.prefecture) {
                d.prefecture = d.prefecture.replace('çœŒ', '');
            }
        });

        // Merge Data
        // We want an array of objects: { year, bearCount, bunaIndex } for a specific prefecture
        function getMergedData(prefecture) {
            const pBuna = bunaData.filter(d => d.prefecture === prefecture);
            const pBear = bearData.filter(d => d.prefecture === prefecture);

            // Get all unique years from both
            const years = new Set([...pBuna.map(d => d.year), ...pBear.map(d => d.year)]);
            const sortedYears = Array.from(years).sort((a, b) => a - b);

            return sortedYears.map(year => {
                const bData = pBuna.find(d => d.year === year);
                const bearD = pBear.find(d => d.year === year);
                return {
                    year: year,
                    bunaIndex: bData ? bData.fruiting : null,
                    bearCount: bearD ? bearD.count : null
                };
            }).filter(d => d.year >= 2008); // Filter to start from 2008 where we have bear data
        }

        const availablePrefectures = ["é’æ£®", "å²©æ‰‹", "å®®åŸ", "ç§‹ç”°", "å±±å½¢"];

        // Thresholds for "Danger" level (Bear Count)
        const prefectureThresholds = {
            "é’æ£®": 5,
            "å²©æ‰‹": 15,
            "å®®åŸ": 3,
            "ç§‹ç”°": 10,
            "å±±å½¢": 5
        };

        // --- COMPONENTS ---

        const BalanceScale = ({ bearCount, threshold = 5 }) => {
            const diff = (bearCount || 0) - threshold;
            let angle = diff * 3;
            // Clamp angle
            if (angle > 25) angle = 25;
            if (angle < -25) angle = -25;

            // Colors
            const beamColor = "#94a3b8"; // Slate

            const isDanger = angle > 5;

            return (
                <div style={{ textAlign: 'center', padding: '20px' }}>
                    <h3 style={{ color: '#f8fafc', marginBottom: '10px' }}>
                        {isDanger ? "âš ï¸ å±é™º: ã‚¯ãƒå„ªå‹¢" : "âœ… å®‰å…¨: äººé‡Œã®å¹³ç©"}
                    </h3>
                    <div style={{ fontSize: '0.9rem', color: '#94a3b8', marginBottom: '20px' }}>
                        ã‚¯ãƒå‡ºæ²¡æ•°: {bearCount || 0} (åŸºæº–: {threshold})
                    </div>

                    <svg width="300" height="150" viewBox="0 0 300 150">
                        {/* Base */}
                        <path d="M 130 140 L 150 100 L 170 140 Z" fill="#475569" />
                        <rect x="100" y="140" width="100" height="10" fill="#334155" rx="5" />

                        {/* Rotating Group (Beam + Pans) */}
                        <g transform={`rotate(${angle}, 150, 100)`} style={{ transition: 'transform 0.5s ease-out' }}>
                            {/* Beam */}
                            <rect x="50" y="95" width="200" height="10" fill={beamColor} rx="5" />

                            {/* Left Pan (Human) */}
                            <line x1="60" y1="100" x2="60" y2="130" stroke={beamColor} strokeWidth="2" />
                            <g transform="translate(60, 130)">
                                {/* Pan shape */}
                                <path d="M -20 0 Q 0 15 20 0" fill="none" stroke={beamColor} strokeWidth="2" />
                                {/* Human Icon */}
                                <text x="-15" y="-5" fontSize="24">ğŸ </text>
                            </g>

                            {/* Right Pan (Bear) */}
                            <line x1="240" y1="100" x2="240" y2="130" stroke={beamColor} strokeWidth="2" />
                            <g transform="translate(240, 130)">
                                {/* Pan shape */}
                                <path d="M -20 0 Q 0 15 20 0" fill="none" stroke={beamColor} strokeWidth="2" />
                                {/* Bear Icon */}
                                <text x="-15" y="-5" fontSize="24">ğŸ»</text>
                            </g>
                        </g>
                    </svg>
                </div>
            );
        };

        // --- MAP COMPONENT ---
        const TohokuMap = ({ selectedPref, onSelect }) => {
            // Simplified SVG paths for Tohoku prefectures
            const paths = {
                "é’æ£®": "M 220 50 L 260 50 L 280 80 L 250 110 L 200 100 L 180 70 Z",
                "å²©æ‰‹": "M 250 110 L 280 80 L 300 150 L 280 220 L 240 200 L 240 150 Z",
                "ç§‹ç”°": "M 180 70 L 200 100 L 240 150 L 240 200 L 200 220 L 170 150 Z",
                "å®®åŸ": "M 240 200 L 280 220 L 270 280 L 230 270 L 230 230 Z",
                "å±±å½¢": "M 170 150 L 200 220 L 230 230 L 230 270 L 190 290 L 160 220 Z",
                "ç¦å³¶": "M 190 290 L 230 270 L 270 280 L 260 350 L 180 340 Z"
            };

            // Center coordinates for labels
            const labels = {
                "é’æ£®": { x: 230, y: 80 },
                "å²©æ‰‹": { x: 270, y: 150 },
                "ç§‹ç”°": { x: 200, y: 150 },
                "å®®åŸ": { x: 260, y: 250 },
                "å±±å½¢": { x: 190, y: 240 },
                "ç¦å³¶": { x: 220, y: 310 }
            };

            return (
                <svg width="100%" height="300" viewBox="150 40 160 320" style={{ filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.3))' }}>
                    {Object.entries(paths).map(([pref, path]) => {
                        const isSelected = selectedPref === pref;
                        return (
                            <g key={pref} onClick={() => onSelect(pref)} style={{ cursor: 'pointer' }}>
                                <path
                                    d={path}
                                    fill={isSelected ? "#ef4444" : "#334155"}
                                    stroke="#1e293b"
                                    strokeWidth="2"
                                    style={{ transition: 'fill 0.3s ease' }}
                                    onMouseEnter={(e) => e.target.style.fill = isSelected ? "#ef4444" : "#475569"}
                                    onMouseLeave={(e) => e.target.style.fill = isSelected ? "#ef4444" : "#334155"}
                                />
                                <text
                                    x={labels[pref].x}
                                    y={labels[pref].y}
                                    textAnchor="middle"
                                    fill="#fff"
                                    fontSize="12"
                                    pointerEvents="none"
                                    fontWeight={isSelected ? "bold" : "normal"}
                                >
                                    {pref}
                                </text>
                            </g>
                        );
                    })}
                </svg>
            );
        };

        const App = () => {
            const [selectedPref, setSelectedPref] = React.useState("ç§‹ç”°");
            const [hoveredData, setHoveredData] = React.useState(null);

            const data = React.useMemo(() => getMergedData(selectedPref), [selectedPref]);
            const currentThreshold = prefectureThresholds[selectedPref] || 5;

            // Calculate correlation stats (simple check)
            const validData = data.filter(d => d.bunaIndex !== null && d.bearCount !== null);
            const lowBunaHighBear = validData.filter(d => d.bunaIndex < 1.0 && d.bearCount > currentThreshold).length;

            // --- UNIFIED SCALES CALCULATION ---
            // Calculate global max for Bear Count across ALL prefectures to unify Y-axis
            const globalMaxBear = React.useMemo(() => {
                let max = 0;
                availablePrefectures.forEach(pref => {
                    const prefData = getMergedData(pref);
                    const prefMax = Math.max(...prefData.map(d => d.bearCount || 0));
                    if (prefMax > max) max = prefMax;
                });
                return Math.ceil(max * 1.1); // Add 10% padding
            }, []);

            // Global max for Buna Index (usually around 5, but let's be safe)
            const globalMaxBuna = 5.5;

            // Determine what data to show in the balance scale
            const activeData = hoveredData || (validData.length > 0 ? validData[validData.length - 1] : null);

            const handleChartHover = (props) => {
                if (props && props.activePayload && props.activePayload.length > 0) {
                    setHoveredData(props.activePayload[0].payload);
                }
            };

            const handleMouseLeave = () => {
                setHoveredData(null);
            };

            return (
                <div className="container">
                    <h1>ãƒ–ãƒŠè±Šå‡¶ã¨ã‚¯ãƒå‡ºæ²¡ã®åˆ†æ</h1>

                    <div className="grid">
                        {/* Left Column: Dashboard & Map */}
                        <div>
                            <div className="card">
                                <div className="card-header">
                                    <div className="card-title">åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                                    <div style={{ color: '#94a3b8', fontSize: '0.9rem' }}>
                                        åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çœŒã‚’é¸æŠ
                                    </div>
                                </div>

                                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '20px' }}>
                                    <TohokuMap selectedPref={selectedPref} onSelect={setSelectedPref} />
                                </div>

                                <div className="grid" style={{ gridTemplateColumns: '1fr 1fr', gap: '10px' }}>
                                    <div className="stat-box">
                                        <div className="stat-value">{validData.length}</div>
                                        <div className="stat-label">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å¹´æ•°</div>
                                    </div>
                                    <div className="stat-box">
                                        <div className="stat-value" style={{ color: '#ef4444' }}>{lowBunaHighBear}</div>
                                        <div className="stat-label">å‡¶ä½œã§å‡ºæ²¡ãŒå¤šã„å¹´</div>
                                        <div style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '4px' }}>
                                            (ãƒ–ãƒŠæŒ‡æ•° &lt; 1.0 ã‹ã¤ å‡ºæ²¡æ•° &gt; {currentThreshold})
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Balance Scale Card */}
                            <div className="card" style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '250px' }}>
                                {activeData ? (
                                    <div style={{ width: '100%' }}>
                                        <div className="card-title" style={{ textAlign: 'center', marginBottom: '0' }}>
                                            ãƒªã‚¹ã‚¯å¤©ç§¤ ({activeData.year}å¹´)
                                        </div>
                                        <BalanceScale bearCount={activeData.bearCount} threshold={currentThreshold} />
                                    </div>
                                ) : (
                                    <div style={{ color: '#94a3b8' }}>ãƒ‡ãƒ¼ã‚¿ãªã—</div>
                                )}
                            </div>
                        </div>

                        {/* Right Column: Charts */}
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                            <div className="card">
                                <div className="card-title" style={{ marginBottom: '20px' }}>æ™‚ç³»åˆ—æ¯”è¼ƒ ({selectedPref})</div>
                                <div className="chart-container">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ComposedChart
                                            data={data}
                                            onMouseMove={handleChartHover}
                                            onMouseLeave={handleMouseLeave}
                                        >
                                            <CartesianGrid stroke="#334155" strokeDasharray="3 3" />
                                            <XAxis dataKey="year" stroke="#94a3b8" />
                                            <YAxis
                                                yAxisId="left"
                                                stroke="#ef4444"
                                                domain={[0, globalMaxBear]}
                                                label={{ value: 'ã‚¯ãƒå‡ºæ²¡ä»¶æ•°', angle: -90, position: 'insideLeft', fill: '#ef4444' }}
                                            />
                                            <YAxis
                                                yAxisId="right"
                                                orientation="right"
                                                stroke="#fbbf24"
                                                domain={[0, globalMaxBuna]}
                                                label={{ value: 'ãƒ–ãƒŠçµå®ŸæŒ‡æ•°', angle: 90, position: 'insideRight', fill: '#fbbf24' }}
                                            />
                                            <Tooltip
                                                contentStyle={{ backgroundColor: '#1e293b', border: '1px solid #334155' }}
                                                labelStyle={{ color: '#f8fafc' }}
                                            />
                                            <Legend />
                                            <Bar yAxisId="left" dataKey="bearCount" name="ã‚¯ãƒå‡ºæ²¡ä»¶æ•°" fill="#ef4444" barSize={20} radius={[4, 4, 0, 0]} />
                                            <Line yAxisId="right" type="monotone" dataKey="bunaIndex" name="ãƒ–ãƒŠçµå®ŸæŒ‡æ•°" stroke="#fbbf24" strokeWidth={3} dot={{ r: 4 }} />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            <div className="card">
                                <div className="card-title" style={{ marginBottom: '20px' }}>ç›¸é–¢æ•£å¸ƒå›³ ({selectedPref})</div>
                                <div className="chart-container">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ScatterChart
                                            margin={{ top: 20, right: 20, bottom: 20, left: 20 }}
                                            onMouseMove={(state) => {
                                                if (state && state.activePayload && state.activePayload.length > 0) {
                                                    setHoveredData(state.activePayload[0].payload);
                                                }
                                            }}
                                            onMouseLeave={handleMouseLeave}
                                        >
                                            <CartesianGrid stroke="#334155" strokeDasharray="3 3" />
                                            <XAxis
                                                type="number"
                                                dataKey="bunaIndex"
                                                name="ãƒ–ãƒŠæŒ‡æ•°"
                                                stroke="#fbbf24"
                                                domain={[0, globalMaxBuna]}
                                                label={{ value: 'ãƒ–ãƒŠæŒ‡æ•°ï¼ˆä½ã„ã»ã©å‡¶ä½œï¼‰', position: 'bottom', fill: '#94a3b8', offset: 0 }}
                                            />
                                            <YAxis
                                                type="number"
                                                dataKey="bearCount"
                                                name="ã‚¯ãƒå‡ºæ²¡ä»¶æ•°"
                                                stroke="#ef4444"
                                                domain={[0, globalMaxBear]}
                                                label={{ value: 'ã‚¯ãƒå‡ºæ²¡ä»¶æ•°', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                                            />
                                            <Tooltip cursor={{ strokeDasharray: '3 3' }} contentStyle={{ backgroundColor: '#1e293b', border: '1px solid #334155' }} />
                                            <Scatter name="å¹´" data={validData} fill="#38bdf8">
                                                {validData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={entry.bunaIndex < 1.0 ? '#ef4444' : '#38bdf8'} />
                                                ))}
                                            </Scatter>
                                        </ScatterChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>